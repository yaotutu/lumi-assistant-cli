# lumi-assistant ç›®å½•ç»“æ„é‡æ„æ–¹æ¡ˆ

## ğŸ“Š å½“å‰ç›®å½•ç»“æ„åˆ†æ

### ğŸ” ç°çŠ¶
```
lumi-assistant/
â”œâ”€â”€ main.py                    # âŒ è¿‡äºè‡ƒè‚¿ï¼ŒåŒ…å«æ‰€æœ‰é€»è¾‘
â”œâ”€â”€ config/config.json         # âœ… é…ç½®æ–‡ä»¶ä½ç½®åˆç†
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ asr/                   # âœ… ç°æœ‰æ¨¡å—ç»“æ„æ¸…æ™°
â”‚   â”œâ”€â”€ llm/                   # âœ… æ–°å¢æ¨¡å—ï¼Œç»“æ„è‰¯å¥½
â”‚   â”œâ”€â”€ tts/                   # âœ… ç°æœ‰æ¨¡å—ç»“æ„æ¸…æ™°
â”‚   â””â”€â”€ utils/                 # âš ï¸ åŠŸèƒ½è¿‡äºæ‚ä¹±ï¼Œéœ€è¦æ‹†åˆ†
â”œâ”€â”€ docs/                      # âœ… æ–‡æ¡£ç›®å½•
â””â”€â”€ test_llm.py               # âš ï¸ æµ‹è¯•è„šæœ¬åº”è¯¥ç»„ç»‡åŒ–
```

### ğŸ”§ å­˜åœ¨çš„é—®é¢˜

1. **main.py è¿‡äºå¤æ‚** - åŒ…å«éŸ³é¢‘å¤„ç†ã€ç”¨æˆ·äº¤äº’ã€æµç¨‹æ§åˆ¶ç­‰æ‰€æœ‰é€»è¾‘
2. **ç¼ºå°‘æ ¸å¿ƒå¼•æ“å±‚** - æ²¡æœ‰ç»Ÿä¸€çš„äº‹ä»¶ç³»ç»Ÿå’Œæ“ä½œæ§åˆ¶å™¨
3. **utils ç›®å½•æ··ä¹±** - é…ç½®ã€æ—¥å¿—ã€éŸ³é¢‘æ’­æ”¾åŠŸèƒ½æ··åœ¨ä¸€èµ·
4. **ç¼ºå°‘æ–°æ¶æ„æ¨¡å—** - intentã€mcpã€grpcã€coreç­‰æ¨¡å—ç›®å½•ä¸å­˜åœ¨
5. **æµ‹è¯•ç»„ç»‡ä¸å½“** - æµ‹è¯•æ–‡ä»¶æ•£è½åœ¨æ ¹ç›®å½•

## ğŸ¯ ç›®æ ‡ç›®å½•ç»“æ„

### ğŸ“ é‡æ„åçš„ç†æƒ³ç»“æ„

```
lumi-assistant/
â”œâ”€â”€ main.py                          # ğŸ”„ ç®€åŒ–çš„å¯åŠ¨å…¥å£
â”œâ”€â”€ config/                          # âš™ï¸ é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ config.json                 # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ intent_config.yaml          # æ„å›¾é…ç½®
â”‚   â””â”€â”€ mcp_tools.json              # MCPå·¥å…·é…ç½®
â”œâ”€â”€ proto/                          # ğŸŒ gRPCåè®®å®šä¹‰
â”‚   â”œâ”€â”€ lumi.proto                  # åè®®å®šä¹‰æ–‡ä»¶
â”‚   â””â”€â”€ generated/                  # ç”Ÿæˆçš„gRPCä»£ç 
â”‚       â”œâ”€â”€ lumi_pb2.py
â”‚       â”œâ”€â”€ lumi_pb2_grpc.py
â”‚       â””â”€â”€ __init__.py
â”œâ”€â”€ src/                            # ğŸ“¦ æ ¸å¿ƒæºç 
â”‚   â”œâ”€â”€ core/                       # ğŸ”¥ æ ¸å¿ƒå¼•æ“å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ events/                 # äº‹ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ event_bus.py        # äº‹ä»¶æ€»çº¿
â”‚   â”‚   â”‚   â”œâ”€â”€ event_types.py      # äº‹ä»¶ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ handlers/           # äº‹ä»¶å¤„ç†å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ audio_handler.py
â”‚   â”‚   â”‚       â””â”€â”€ text_handler.py
â”‚   â”‚   â”œâ”€â”€ audio_engine.py         # éŸ³é¢‘å¤„ç†å¼•æ“
â”‚   â”‚   â”œâ”€â”€ conversation_manager.py # å¯¹è¯ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ operation_controller.py # æ“ä½œæ§åˆ¶å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ intent/                     # ğŸ§  æ„å›¾è¯†åˆ«å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                 # æ„å›¾è¯†åˆ«åŸºç±»
â”‚   â”‚   â”œâ”€â”€ llm_intent.py           # LLMæ„å›¾è¯†åˆ«å™¨
â”‚   â”‚   â”œâ”€â”€ intent_router.py        # æ„å›¾è·¯ç”±å™¨
â”‚   â”‚   â””â”€â”€ handlers/               # æ„å›¾å¤„ç†å™¨
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ chat_handler.py     # é—²èŠå¤„ç†å™¨
â”‚   â”‚       â”œâ”€â”€ tool_handler.py     # å·¥å…·è°ƒç”¨å¤„ç†å™¨
â”‚   â”‚       â””â”€â”€ command_handler.py  # å‘½ä»¤å¤„ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ mcp/                        # ğŸ”§ MCPå·¥å…·è°ƒç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ mcp_client.py           # MCPåè®®å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ tool_manager.py         # å·¥å…·ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ tool_executor.py        # å·¥å…·æ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ tool_registry.py        # å·¥å…·æ³¨å†Œè¡¨
â”‚   â”‚   â””â”€â”€ tools/                  # MCPå·¥å…·å®ç°
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ system_tools.py     # ç³»ç»Ÿå·¥å…·
â”‚   â”‚       â””â”€â”€ iot_tools.py        # IoTå·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ iot/                        # ğŸ  IoTè®¾å¤‡æ§åˆ¶å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ device_manager.py       # è®¾å¤‡ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ device_discovery.py     # è®¾å¤‡å‘ç°
â”‚   â”‚   â”œâ”€â”€ device_controller.py    # è®¾å¤‡æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ device_status.py        # è®¾å¤‡çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ devices/                # å…·ä½“è®¾å¤‡å®ç°
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ smart_lamp.py       # æ™ºèƒ½ç¯
â”‚   â”‚       â””â”€â”€ smart_speaker.py    # æ™ºèƒ½éŸ³å“
â”‚   â”‚
â”‚   â”œâ”€â”€ grpc/                       # ğŸŒ gRPCæ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ grpc_server.py          # gRPCæœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ grpc_client.py          # gRPCå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ service_impl.py         # æœåŠ¡å®ç°
â”‚   â”‚   â””â”€â”€ interceptors/           # æ‹¦æˆªå™¨
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ auth_interceptor.py
â”‚   â”‚       â””â”€â”€ logging_interceptor.py
â”‚   â”‚
â”‚   â”œâ”€â”€ interfaces/                 # ğŸ“± ç•Œé¢æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_interface.py       # æ¥å£åŸºç±»
â”‚   â”‚   â”œâ”€â”€ cli_interface.py        # CLIæ¥å£
â”‚   â”‚   â””â”€â”€ grpc_interface.py       # gRPCæ¥å£é€‚é…
â”‚   â”‚
â”‚   â”œâ”€â”€ dialogue/                   # ğŸ’¬ å¯¹è¯ç®¡ç†å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ conversation.py         # å¯¹è¯ä¼šè¯
â”‚   â”‚   â”œâ”€â”€ history_manager.py      # å†å²ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ context_manager.py      # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚   â””â”€â”€ storage/                # å­˜å‚¨å±‚
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ sqlite_storage.py   # SQLiteå­˜å‚¨
â”‚   â”‚       â””â”€â”€ memory_storage.py   # å†…å­˜å­˜å‚¨
â”‚   â”‚
â”‚   â”œâ”€â”€ llm/                        # ğŸ¤– LLMé›†æˆå±‚ (ç°æœ‰)
â”‚   â”œâ”€â”€ asr/                        # ğŸ¯ è¯­éŸ³è¯†åˆ«å±‚ (ç°æœ‰)
â”‚   â”œâ”€â”€ tts/                        # ğŸ¤ è¯­éŸ³åˆæˆå±‚ (ç°æœ‰)
â”‚   â”‚
â”‚   â””â”€â”€ utils/                      # ğŸ› ï¸ å·¥å…·å±‚ (é‡æ„)
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ config_manager.py
â”‚       â”œâ”€â”€ logging/                # æ—¥å¿—ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ logging_config.py
â”‚       â”œâ”€â”€ audio/                  # éŸ³é¢‘å·¥å…·
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ audio_player.py
â”‚       â””â”€â”€ helpers/                # é€šç”¨åŠ©æ‰‹
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ file_utils.py
â”‚           â””â”€â”€ time_utils.py
â”‚
â”œâ”€â”€ tests/                          # ğŸ§ª æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ unit/                       # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_llm.py
â”‚   â”‚   â”œâ”€â”€ test_asr.py
â”‚   â”‚   â””â”€â”€ test_tts.py
â”‚   â”œâ”€â”€ integration/                # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_conversation.py
â”‚   â”‚   â””â”€â”€ test_grpc_api.py
â”‚   â””â”€â”€ e2e/                        # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚       â””â”€â”€ test_full_flow.py
â”‚
â”œâ”€â”€ examples/                       # ğŸ“š ç¤ºä¾‹å’Œæ¼”ç¤º
â”‚   â”œâ”€â”€ cli_client.py               # CLIå®¢æˆ·ç«¯ç¤ºä¾‹
â”‚   â”œâ”€â”€ grpc_client.py              # gRPCå®¢æˆ·ç«¯ç¤ºä¾‹
â”‚   â””â”€â”€ gui_client.py               # GUIå®¢æˆ·ç«¯ç¤ºä¾‹(æœªæ¥)
â”‚
â”œâ”€â”€ scripts/                        # ğŸ”§ è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ setup.py                    # ç¯å¢ƒè®¾ç½®è„šæœ¬
â”‚   â”œâ”€â”€ generate_proto.py           # Protocol Bufferç”Ÿæˆè„šæœ¬
â”‚   â””â”€â”€ migrate_data.py             # æ•°æ®è¿ç§»è„šæœ¬
â”‚
â”œâ”€â”€ docs/                           # ğŸ“– æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ api/                        # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ architecture/               # æ¶æ„æ–‡æ¡£
â”‚   â””â”€â”€ user_guide/                 # ç”¨æˆ·æŒ‡å—
â”‚
â””â”€â”€ [é¡¹ç›®æ–‡ä»¶]                      # é¡¹ç›®é…ç½®æ–‡ä»¶
    â”œâ”€â”€ requirements.txt
    â”œâ”€â”€ requirements-dev.txt        # å¼€å‘ä¾èµ–
    â”œâ”€â”€ setup.py                    # åŒ…å®‰è£…é…ç½®
    â”œâ”€â”€ pyproject.toml              # é¡¹ç›®å…ƒæ•°æ®
    â”œâ”€â”€ .gitignore
    â”œâ”€â”€ TODO.md
    â”œâ”€â”€ CLAUDE.md
    â”œâ”€â”€ DEVELOPMENT_PLAN.md
    â””â”€â”€ MISSING_FEATURES.md
```

## ğŸ”„ é‡æ„å®æ–½æ–¹æ¡ˆ

### é˜¶æ®µä¸€ï¼šåˆ›å»ºæ–°ç›®å½•ç»“æ„ (æ— ç ´åæ€§)

1. **åˆ›å»ºæ ¸å¿ƒç›®å½•**
```bash
mkdir -p src/core/{events,handlers}
mkdir -p src/intent/handlers
mkdir -p src/mcp/tools
mkdir -p src/iot/devices
mkdir -p src/grpc/interceptors
mkdir -p src/interfaces
mkdir -p src/dialogue/storage
mkdir -p proto/generated
mkdir -p tests/{unit,integration,e2e}
mkdir -p examples scripts
```

2. **é‡æ„utilsç›®å½•**
```bash
mkdir -p src/utils/{config,logging,audio,helpers}
```

### é˜¶æ®µäºŒï¼šä»£ç è¿ç§» (æ¸è¿›å¼)

#### 2.1 åˆ›å»ºäº‹ä»¶ç³»ç»ŸåŸºç¡€è®¾æ–½
- [ ] åˆ›å»º `src/core/events/event_bus.py`
- [ ] åˆ›å»º `src/core/events/event_types.py` 
- [ ] å®šä¹‰åŸºç¡€äº‹ä»¶ç±»å‹

#### 2.2 æ‹†åˆ†main.pyé€»è¾‘
- [ ] æå–éŸ³é¢‘å¤„ç†åˆ° `src/core/audio_engine.py`
- [ ] åˆ›å»ºå¯¹è¯ç®¡ç†å™¨ `src/core/conversation_manager.py`
- [ ] åˆ›å»ºæ“ä½œæ§åˆ¶å™¨ `src/core/operation_controller.py`
- [ ] ç®€åŒ–main.pyä¸ºå¯åŠ¨å…¥å£

#### 2.3 é‡æ„utilsæ¨¡å—
- [ ] ç§»åŠ¨é…ç½®ç®¡ç†åˆ° `src/utils/config/`
- [ ] ç§»åŠ¨æ—¥å¿—é…ç½®åˆ° `src/utils/logging/`
- [ ] ç§»åŠ¨éŸ³é¢‘æ’­æ”¾åˆ° `src/utils/audio/`

#### 2.4 åˆ›å»ºinterfaceæŠ½è±¡å±‚
- [ ] åˆ›å»º `src/interfaces/base_interface.py`
- [ ] åˆ›å»º `src/interfaces/cli_interface.py`
- [ ] ä»main.pyæå–CLIé€»è¾‘

### é˜¶æ®µä¸‰ï¼šæ–°åŠŸèƒ½æ¨¡å— (æ‰©å±•æ€§)

#### 3.1 æ„å›¾è¯†åˆ«æ¨¡å—
- [ ] åˆ›å»º `src/intent/` å®Œæ•´ç»“æ„
- [ ] å®ç°åŸºç¡€æ„å›¾è¯†åˆ«å™¨

#### 3.2 MCPå·¥å…·è°ƒç”¨æ¨¡å—  
- [ ] åˆ›å»º `src/mcp/` å®Œæ•´ç»“æ„
- [ ] å®ç°åŸºç¡€MCPå®¢æˆ·ç«¯

#### 3.3 gRPCæ¥å£æ¨¡å—
- [ ] å®šä¹‰ `proto/lumi.proto`
- [ ] ç”ŸæˆPython gRPCä»£ç 
- [ ] å®ç°gRPCæœåŠ¡å™¨

### é˜¶æ®µå››ï¼šæµ‹è¯•å’Œæ–‡æ¡£å®Œå–„

#### 4.1 æµ‹è¯•é‡æ„
- [ ] ç§»åŠ¨ç°æœ‰æµ‹è¯•åˆ° `tests/unit/`
- [ ] åˆ›å»ºé›†æˆæµ‹è¯•
- [ ] æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•

#### 4.2 ç¤ºä¾‹å’Œè„šæœ¬
- [ ] åˆ›å»ºå®¢æˆ·ç«¯ç¤ºä¾‹
- [ ] æ·»åŠ å®ç”¨è„šæœ¬

## âš ï¸ é‡æ„æ³¨æ„äº‹é¡¹

### ä¿æŒå‘åå…¼å®¹
1. **åˆ†æ­¥è¿ç§»**: ä¸è¦ä¸€æ¬¡æ€§é‡æ„æ‰€æœ‰ä»£ç 
2. **ä¿ç•™æ—§æ¥å£**: åœ¨æ–°æ¥å£ç¨³å®šå‰ä¿æŒæ—§æ¥å£å¯ç”¨
3. **æ¸è¿›å¼é‡æ„**: å…ˆåˆ›å»ºæ–°ç»“æ„ï¼Œå†é€æ­¥è¿ç§»åŠŸèƒ½

### æ¨¡å—ä¾èµ–ç®¡ç†
1. **æ˜ç¡®ä¾èµ–å±‚æ¬¡**: core â†’ intent/mcp â†’ interfaces
2. **é¿å…å¾ªç¯ä¾èµ–**: ä½¿ç”¨ä¾èµ–æ³¨å…¥å’Œäº‹ä»¶è§£è€¦
3. **æ¥å£æŠ½è±¡**: é€šè¿‡æŠ½è±¡æ¥å£é™ä½æ¨¡å—è€¦åˆ

### é…ç½®ç®¡ç†
1. **åˆ†å±‚é…ç½®**: æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç¦»é…ç½®æ–‡ä»¶
2. **ç¯å¢ƒåŒºåˆ†**: æ”¯æŒå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®
3. **é…ç½®éªŒè¯**: æ·»åŠ é…ç½®æ–‡ä»¶æ ¼å¼éªŒè¯

## ğŸ¯ é‡æ„çš„æ ¸å¿ƒä»·å€¼

### æ¶æ„æ¸…æ™°
- **åˆ†å±‚æ˜ç¡®**: æ¯ä¸ªç›®å½•æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ
- **æ¨¡å—ç‹¬ç«‹**: æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
- **æ‰©å±•æ–¹ä¾¿**: æ–°åŠŸèƒ½æœ‰æ˜ç¡®çš„æ·»åŠ ä½ç½®

### å¼€å‘æ•ˆç‡
- **ä»£ç ç»„ç»‡**: ç›¸å…³ä»£ç é›†ä¸­ï¼Œä¾¿äºæŸ¥æ‰¾å’Œç»´æŠ¤
- **æµ‹è¯•å‹å¥½**: æ¨¡å—åŒ–ç»“æ„ä¾¿äºç¼–å†™å•å…ƒæµ‹è¯•
- **å›¢é˜Ÿåä½œ**: æ¸…æ™°çš„ç›®å½•ç»“æ„ä¾¿äºå¤šäººå¼€å‘

### æœªæ¥æ¼”è¿›
- **å¤šæ¥å£æ”¯æŒ**: CLIã€gRPCã€GUIç­‰å¤šç§æ¥å£å¹¶å­˜
- **åŠŸèƒ½æ‰©å±•**: æ–°åŠŸèƒ½æ¨¡å—æœ‰æ ‡å‡†åŒ–çš„æ·»åŠ æ–¹å¼
- **å¹³å°å…¼å®¹**: æ”¯æŒä¸åŒéƒ¨ç½²ç¯å¢ƒå’Œä½¿ç”¨åœºæ™¯

è¿™ä¸ªé‡æ„æ–¹æ¡ˆå°†ä½¿lumi-assistantä»å•ä½“åº”ç”¨è¿›åŒ–ä¸ºæ¨¡å—åŒ–ã€å¯æ‰©å±•çš„AIåŠ©æ‰‹å¹³å°ï¼